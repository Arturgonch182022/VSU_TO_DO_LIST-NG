<div class="background">
  <div class="gradient-bg"></div>
  <div class="gradient-blur"></div>
</div>

<div class="theme-toggle">
  <button class="btn btn-theme" (click)="toggleTheme()">
    @if (isDarkMode) {
      ‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞
    } @else {
      üåô –¢—ë–º–Ω–∞—è —Ç–µ–º–∞
    }
  </button>
</div>

<div class="container">
  <h1>üìù To-Do List Pro</h1>

  @if (tasks.length > 0) {
    <div class="stats">
      <div class="stats-grid">
        <div class="stat-item">
          <span class="stat-label">–í—Å–µ–≥–æ –∑–∞–¥–∞—á:</span>
          <span class="stat-value">{{ tasksCount }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ:</span>
          <span class="stat-value">{{ completedCount }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">–û—Å—Ç–∞–ª–æ—Å—å:</span>
          <span class="stat-value">{{ pendingCount }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">–í—Å–µ–≥–æ —Å—Å—ã–ª–æ–∫:</span>
          <span class="stat-value">{{ totalLinksCount }}</span>
        </div>
      </div>
      @if (completedCount > 0) {
        <button class="btn btn-clear" (click)="clearCompleted()">
          üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ
        </button>
      }
    </div>
  }

  <div class="task-form">
    <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É</h3>
    <div class="form-group">
      <label for="title">–ó–∞–¥–∞–Ω–∏–µ *</label>
      <input
        type="text"
        id="title"
        class="form-control"
        [ngModel]="newTaskTitle"
        (ngModelChange)="updateNewTaskTitle($event)"
        placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ"
        (keyup.enter)="addTask()"
      >
    </div>

    <div class="form-group">
      <label>üîó –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
      <div class="link-input-group">
        <input
          type="url"
          class="form-control link-input"
          [ngModel]="currentLink"
          (ngModelChange)="updateCurrentLink($event)"
          placeholder="https://example.com"
          (keyup.enter)="addLinkToNewTask()"
        >
        <button class="btn btn-secondary" (click)="addLinkToNewTask()" [disabled]="!currentLink.trim()">
          –î–æ–±–∞–≤–∏—Ç—å
        </button>
      </div>
      <small class="form-text">
        –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ {{ linkSettings.maxLinksPerTask }} —Å—Å—ã–ª–æ–∫
      </small>
    </div>

    @if (newTaskLinks.length > 0) {
      <div class="links-preview">
        <h4>–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏:</h4>
        <ul class="links-list">
          @for (link of newTaskLinks; track $index) {
            <li class="link-item">
              <div class="link-content">
                @if (linkSettings.showLinkIcons) {
                  <img [src]="getFaviconUrl(link)"
                       class="link-favicon"
                       alt="favicon">
                }
                <a [href]="link" target="_blank" rel="noopener noreferrer" class="link-url">
                  {{ getDomain(link) }}
                </a>
                <button class="btn btn-link-remove" (click)="removeLinkFromNewTask($index)" title="–£–¥–∞–ª–∏—Ç—å —Å—Å—ã–ª–∫—É">
                  ‚ùå
                </button>
              </div>
            </li>
          }
        </ul>
        <div class="link-counter">
          –°—Å—ã–ª–æ–∫: {{ newTaskLinks.length }}/{{ linkSettings.maxLinksPerTask }}
        </div>
      </div>
    }

    <button class="btn btn-primary" (click)="addTask()" [disabled]="!newTaskTitle.trim()">
      ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É
    </button>
  </div>

  @if (editingTask) {
    <div class="edit-form">
      <h3>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</h3>
      <div class="form-group">
        <label>–ó–∞–¥–∞–Ω–∏–µ</label>
        <input
          type="text"
          class="form-control"
          [ngModel]="editTitle"
          (ngModelChange)="updateEditTitle($event)"
          (keyup.enter)="saveEdit()"
        >
      </div>

      <div class="form-group">
        <label>üîó –°—Å—ã–ª–∫–∏</label>
        <div class="link-input-group">
          <input
            type="url"
            class="form-control link-input"
            [ngModel]="currentEditLink"
            (ngModelChange)="updateCurrentEditLink($event)"
            placeholder="https://example.com"
            (keyup.enter)="addLinkToEditTask()"
          >
          <button class="btn btn-secondary" (click)="addLinkToEditTask()" [disabled]="!currentEditLink.trim()">
            –î–æ–±–∞–≤–∏—Ç—å
          </button>
        </div>
      </div>

      @if (editLinks.length > 0) {
        <div class="links-preview">
          <h4>–°—Å—ã–ª–∫–∏ –∑–∞–¥–∞—á–∏:</h4>
          <ul class="links-list">
            @for (link of editLinks; track $index) {
              <li class="link-item">
                <div class="link-content">
                  @if (linkSettings.showLinkIcons) {
                    <img [src]="getFaviconUrl(link)"
                         class="link-favicon"
                         alt="favicon">
                  }
                  <a [href]="link" target="_blank" rel="noopener noreferrer" class="link-url">
                    {{ getDomain(link) }}
                  </a>
                  <button class="btn btn-link-remove" (click)="removeLinkFromEditTask($index)" title="–£–¥–∞–ª–∏—Ç—å —Å—Å—ã–ª–∫—É">
                    ‚ùå
                  </button>
                </div>
              </li>
            }
          </ul>
          <div class="link-counter">
            –°—Å—ã–ª–æ–∫: {{ editLinks.length }}/{{ linkSettings.maxLinksPerTask }}
          </div>
        </div>
      }

      <div class="form-actions">
        <button class="btn btn-success" (click)="saveEdit()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="btn btn-warning" (click)="cancelEdit()">‚ùå –û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  }

  <div class="tasks-container">
    @if (tasks.length === 0) {
      <div class="no-tasks">
        <div class="empty-state">
          üì≠ –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –ø—É—Å—Ç
          <p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É, –∏—Å–ø–æ–ª—å–∑—É—è —Ñ–æ—Ä–º—É –≤—ã—à–µ</p>
        </div>
      </div>
    }

    <ul class="task-list">
      @for (task of tasks; track task.id) {
        <li class="task-item" [class.completed]="task.completed">
          <div class="task-header">
            <input
              type="checkbox"
              class="task-checkbox"
              [checked]="task.completed"
              (change)="toggleComplete(task.id)"
              [id]="'task-' + task.id"
            >
            <label [for]="'task-' + task.id" class="task-title">
              {{ task.title }}
            </label>
            @if (task.links.length > 0) {
              <span class="task-badge">
                üîó {{ task.links.length }}
              </span>
            }
          </div>

          @if (task.links.length > 0) {
            <div class="task-links">
              <h4>–°–≤—è–∑–∞–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏:</h4>
              <div class="links-grid">
                @for (link of task.links; track $index) {
                  <div class="task-link-item">
                    <a [href]="link"
                       target="_blank"
                       rel="noopener noreferrer"
                       class="task-link">
                      @if (linkSettings.showLinkIcons) {
                        <img [src]="getFaviconUrl(link)"
                             class="link-favicon"
                             alt="favicon">
                      }
                      <span class="link-text">{{ getDomain(link) }}</span>
                    </a>
                  </div>
                }
              </div>
            </div>
          }

          <div class="task-footer">
            <div class="task-meta">
              <span class="task-date">üìÖ {{ task.createdAt | date:'dd.MM.yyyy HH:mm' }}</span>
              <span class="task-status" [class.completed-text]="task.completed">
                @if (task.completed) {
                  ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ
                } @else {
                  ‚è≥ –í –ø—Ä–æ—Ü–µ—Å—Å–µ
                }
              </span>
            </div>

            <div class="task-actions">
              <button class="btn btn-edit" (click)="startEdit(task)" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                ‚úèÔ∏è
              </button>
              <button class="btn btn-delete" (click)="deleteTask(task.id)" title="–£–¥–∞–ª–∏—Ç—å">
                üóëÔ∏è
              </button>
            </div>
          </div>
        </li>
      }
    </ul>
  </div>
</div>
